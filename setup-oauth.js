// setup-oauth.js
// Script h·ªó tr·ª£ t·∫°o file .env cho OAuth2

const fs = require('fs');
const readline = require('readline');

const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
});

function question(query) {
    return new Promise(resolve => rl.question(query, resolve));
}

async function setupOAuth() {
    console.log('=== THI·∫æT L·∫¨P OAUTH2 CHO TECHSTORE ===\n');
    console.log('B·∫°n c·∫ßn c√≥ Google OAuth2 Client ID v√† Client Secret t·ª´ Google Cloud Console.');
    console.log('N·∫øu ch∆∞a c√≥, h√£y l√†m theo c√°c b∆∞·ªõc sau:\n');
    console.log('1. Truy c·∫≠p: https://console.cloud.google.com/');
    console.log('2. T·∫°o project m·ªõi ho·∫∑c ch·ªçn project hi·ªán c√≥');
    console.log('3. V√†o APIs & Services > OAuth consent screen (c·∫•u h√¨nh tr∆∞·ªõc)');
    console.log('4. V√†o APIs & Services > Credentials');
    console.log('5. Click "Create Credentials" > "OAuth client ID"');
    console.log('6. Ch·ªçn "Web application"');
    console.log('7. ƒêi·ªÅn:');
    console.log('   - Authorized JavaScript origins: http://localhost:5000');
    console.log('   - Authorized redirect URIs: http://localhost:5000/api/auth/google/callback');
    console.log('8. Copy Client ID v√† Client Secret\n');

    const hasCredentials = await question('B·∫°n ƒë√£ c√≥ Client ID v√† Client Secret ch∆∞a? (y/n): ');
    
    if (hasCredentials.toLowerCase() !== 'y' && hasCredentials.toLowerCase() !== 'yes') {
        console.log('\nVui l√≤ng l√†m theo h∆∞·ªõng d·∫´n tr√™n ƒë·ªÉ l·∫•y credentials, sau ƒë√≥ ch·∫°y l·∫°i script n√†y.');
        rl.close();
        return;
    }

    console.log('\nNh·∫≠p th√¥ng tin OAuth2:\n');
    
    const clientId = await question('Google Client ID: ');
    const clientSecret = await question('Google Client Secret: ');
    const callbackUrl = await question('Callback URL (Enter ƒë·ªÉ d√πng m·∫∑c ƒë·ªãnh): ') || 'http://localhost:5000/api/auth/google/callback';

    if (!clientId || !clientSecret) {
        console.log('\n‚ùå Client ID v√† Client Secret kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!');
        rl.close();
        return;
    }

    // T·∫°o n·ªôi dung file .env
    const envContent = `# Google OAuth2 Configuration
# Generated by setup-oauth.js

GOOGLE_CLIENT_ID=${clientId}
GOOGLE_CLIENT_SECRET=${clientSecret}
GOOGLE_CALLBACK_URL=${callbackUrl}
`;

    // Ki·ªÉm tra file .env ƒë√£ t·ªìn t·∫°i ch∆∞a
    if (fs.existsSync('.env')) {
        const overwrite = await question('\nFile .env ƒë√£ t·ªìn t·∫°i. Ghi ƒë√®? (y/n): ');
        if (overwrite.toLowerCase() !== 'y' && overwrite.toLowerCase() !== 'yes') {
            console.log('\nƒê√£ h·ªßy. File .env kh√¥ng ƒë∆∞·ª£c thay ƒë·ªïi.');
            rl.close();
            return;
        }
    }

    // Ghi file .env
    try {
        fs.writeFileSync('.env', envContent);
        console.log('\n‚úÖ ƒê√£ t·∫°o file .env th√†nh c√¥ng!');
        console.log('\nüìù N·ªôi dung file .env:');
        console.log('‚îÄ'.repeat(50));
        console.log(envContent);
        console.log('‚îÄ'.repeat(50));
        console.log('\n‚ö†Ô∏è  L∆ØU √ù:');
        console.log('   - File .env ch·ª©a th√¥ng tin nh·∫°y c·∫£m, KH√îNG commit v√†o Git');
        console.log('   - H√£y restart server ƒë·ªÉ √°p d·ª•ng c·∫•u h√¨nh m·ªõi');
        console.log('   - Ch·∫°y: node server.js');
    } catch (error) {
        console.error('\n‚ùå L·ªói khi t·∫°o file .env:', error.message);
    }

    rl.close();
}

setupOAuth();


